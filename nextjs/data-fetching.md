# データ取得
データを取得するには、以下の方法がある。

- APIレイヤー
  - アプリケーションとデータベースとの中間層となる。APIが使用されるケースはいくつか考えられる
    - APIを提供するサードパーティのサービスを使用している
    - クライアントからデータを取得する場合、データベースの秘密がクライアントに公開されないようにするために、サーバー上で実行されるAPIレイヤーが必要となる
- データベースクエリ
  - フルスタックアプリケーションを開発する場合、データベースとやり取りするためのクエリが必要となる。データベースクエリを使用されるケースはいくつか考えられる
    - APIエンドポイントを開発する場合、データベースとやり取りするためのロジックが必要となる
    - サーバーコンポーネントを使用している場合、APIレイヤーをスキップし、データベースの秘密をクライアントに公開するリスクなしで、データベースと直接やり取りすることができる

## サーバーコンポーネント
Next.jsではデフォルトでサーバーコンポーネントとなる。

- `Promise`をサポートしており、データ取得などの非同期タスクを簡単に実装することができる
- `async/await`構文を使用できる
- `fetch`を使用できる
- サーバー上で実行されるため、APIレイヤーなしでデータベースと直接やり取りすることができる

```tsx
export async function ProductTitle({ id }) {
  const res = await fetch(`https://dummyjson.com/products/${id}`);
  const product = await res.json();

  return <div>{product.title}</div>;
}
```

## 注意事項
- データ要求が意図せず相互にブロックされ、リクエストウォーターフォールが発生する可能性がある
- デフォルトでは、Next.js はパフォーマンスを向上させるためにルートを事前レンダリングする。これは、静的レンダリングと呼ばれる。そのため、データが変更されてもページに反映されない

## リクエストウォーターフォールとは
「ウォーターフォール」とは、前のリクエストの完了に依存する一連のネットワークリクエストを指す。データ取得の場合、各リクエストは前のリクエストがデータを返した後にのみ開始できる。

## 並列データ取得
ウォーターフォールを回避する一般的な方法は、すべてのデータ要求を同時に、つまり並行して開始する。
JavaScriptでは、`Promise.all()`または`Promise.allSettled()`関数を使用して、すべての`Promise`を同時に開始できる。
